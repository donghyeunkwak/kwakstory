<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>곽씨이야기</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Pretendard&display=swap" rel="stylesheet"/>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Pretendard', sans-serif;
  background: linear-gradient(135deg, #f0faff, #d6f0ff)
  color: #444;
  text-align: center;
  position: relative;
  overflow-x: hidden;
}

/* 🔮 엠비언트 글로우 */
.ambient-glow {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: -1;
  overflow: hidden;
}
.glow {
  position: absolute;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,200,200,0.4), transparent 70%);
  filter: blur(80px);
  animation: float 12s ease-in-out infinite alternate;
}
.glow:nth-child(2) {
  top: 30%;
  left: 60%;
  background: radial-gradient(circle, rgba(200,255,255,0.4), transparent 70%);
  animation-delay: 3s;
}
.glow:nth-child(3) {
  top: 70%;
  left: 20%;
  background: radial-gradient(circle, rgba(200,255,200,0.4), transparent 70%);
  animation-delay: 6s;
}
@keyframes float {
  0% { transform: translate(0, 0) scale(1); }
  100% { transform: translate(40px, -30px) scale(1.2); }
}

/* 🧊 헤더 + 블러 배경 */
header {
  position: relative;
  padding: 60px 20px 30px;
  overflow: hidden;
  border-bottom: 1px solid #eeeeee;
}
.header-blur-bg {
  background:linear-gradient(135deg, #f0faff, #d6f0ff);
  filter: blur(8px);
  opacity: 0.8;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 0;
}
header > *:not(.header-blur-bg) {
  position: relative;
  z-index: 1;
}

/* 🧑‍🎤 프로필 */
.profile {
  width: 100px;
  height: 100px;
  margin: 0 auto 15px;
  border-radius: 50%;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  border: 2px solid #ddd;
}
.profile img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
header h1 {
  font-family: 'Nanum Pen Script', cursive;
  font-size: 3.2em;
  margin-bottom: 10px;
  color: #2c2c2c;
}
header p {
  font-size: 1.1em;
  color: #777;
}

/* 🎵 음악플레이어 */
.music-player {
  margin-top: 30px;
}
#visualizer {
  width: 50%;
  max-width: 500px;
  height: 50px;
  display: block;
  margin: 20px auto 10px;
  background: transparent;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
#playBtn {
  padding: 12px 24px;
  font-size: 1em;
  font-weight: bold;
  color: rgb(0, 0, 0);
  background: transparent;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}
#playBtn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}

/* 🧩 카테고리 섹션 */
.category-section {
  overflow-x: auto;
  padding: 20px 10px;
  scroll-snap-type: x mandatory;
}
.category-grid {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 10px;
  padding: 10px 0;
  scroll-snap-type: x mandatory;
  justify-content: center; /* ✅ 가운데 정렬 */
}
.category-grid::-webkit-scrollbar {
  display: none;
}
.category-card {
  display: inline-block;
  padding: 6px 14px; /* ✅ 세로 padding 줄임 */
  font-family: 'Nanum Pen Script', cursive;
  font-size: 18px;
  font-weight: normal;
  text-decoration: none;
  color: #2c2c2c;
  background-color:linear-gradient(135deg, #f0faff, #d6f0ff);
  scroll-snap-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
  border-radius: 8px;
  white-space: nowrap;
  flex: 0 0 auto;
  height: auto; /* ✅ 높이 강제 없음 */
  line-height: 1.4; /* ✅ 줄 간격 자연스럽게 */
}


.pastel1 { background: #fff1f0; }
.pastel2 { background: #f0faff; }
.pastel3 { background: #fefbe7; }
.pastel4 { background: #f6f0ff; }

/* 📝 본문 영역 */
main {
  padding: 50px 20px;
  max-width: 900px;
  margin: 0 auto;
}
.post-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.category-card {
  display: inline-flex; /* ✅ inline-block → inline-flex */
  align-items: center;  /* ✅ 세로 중앙 정렬 */
  justify-content: center; /* ✅ 가로 중앙 정렬 */
  padding: 6px 16px;
  font-family: 'Nanum Pen Script', cursive;
  font-size: 18px;
  font-weight: normal;
  text-decoration: none;
  color: #2c2c2c;
  background-color:linear-gradient(135deg, #f0faff, #d6f0ff);
  scroll-snap-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
  border-radius: 8px;
  white-space: nowrap;
  flex: 0 0 auto;
  height: auto;
  line-height: 1; /* ✅ 필요 시 줄 간격 더 타이트하게 */
}

.post-card:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  transform: translateY(-4px);
}
.post-title {
  font-weight: bold;
  font-size: 1.2em;
  margin-bottom: 8px;
}
.post-excerpt {
  color: #666;
  font-size: 0.95em;
}

/* 📄 글 상세 */
article {
  background: #fff;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  text-align: left;
  line-height: 1.8;
}
article h2 {
  font-size: 1.8em;
  margin-bottom: 16px;
}
article p {
  margin-bottom: 12px;
}
#backBtn {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 0.9em;
  border: none;
  background: linear-gradient(135deg, #f0faff, #d6f0ff);
  border-radius: 10px;
  cursor: pointer;
}

/* 📱 모바일 대응 */
@media (max-width: 600px) {
  main {
    max-width: 100%;
    padding: 30px 16px;
  }
  .post-card,
  article {
    border-radius: 14px;
    font-size: 1em;
    line-height: 1.8;
  }
  .post-title {
    font-size: 1.2em;
  }
}

.door {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 50%;
  background: #fefefe;
  z-index: 9999;
  transition: transform 1.2s ease;
}

.left-door {
  left: 0;
  transform: translateX(0);
}

.right-door {
  right: 0;
  transform: translateX(0);
}


  </style>
</head>
<body>

  <div class="door left-door"></div>
<div class="door right-door"></div>


  <!-- 배경 -->
  <div class="ambient-glow">
    <div class="glow" style="top:10%; left:10%;"></div>
    <div class="glow"></div>
    <div class="glow"></div>
  </div>

  <header>
    <div class="header-blur-bg"></div>
    <div class="profile">
      <img src="images/a.png" alt="곽 프로필" />
    </div>
    <h1>곽씨이야기</h1>
    <p>세상의 흔들리지 않고 나답게 살아가기 위한 생각과 기록의 공간</p>
    <audio id="audio" crossorigin="anonymous"></audio>
    <div class="music-player">
      <canvas id="visualizer" width="600" height="150"></canvas>
      <button id="playBtn">재생</button>
    </div>
  </header>

  <section class="category-section">
    <div class="category-grid">
      <a href="#" class="category-card pastel1" data-category="세상이야기"><br/>세상이야기</a>
      <a href="#" class="category-card pastel2" data-category="개발이야기"><br/>개발이야기</a>
      <a href="#" class="category-card pastel3" data-category="점이이야기"><br/>점이이야기</a>
      <a href="#" class="category-card pastel4" data-category="일상이야기"><br/>일상이야기</a>
    </div>
  </section>
  

  <main id="content"></main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const audio = document.getElementById('audio');
      const playBtn = document.getElementById('playBtn');
      const canvas = document.getElementById('visualizer');
      const ctx = canvas.getContext('2d');
  
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createMediaElementSource(audio);
      const analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
  
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
  
      source.connect(analyser);
      analyser.connect(audioCtx.destination);
  
      const playlist = [
        { src: 'music/music.mp3', image: 'images/music.jpg' },
        { src: 'music/music1.mp3', image: 'images/music1.jpg' },
      ];
      let currentTrack = 0;
  
      function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
  
        const barWidth = (canvas.width / bufferLength) * 1.5;
        const barGap = 2;
        let x = 0;
        for (let i = 0; i < bufferLength; i++) {
          const barHeight = dataArray[i];
          const hue = i * 3;
          ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
          ctx.fillRect(x, canvas.height - barHeight, barWidth - barGap, barHeight);
          x += barWidth;
        }
      }
  
      function updateHeaderBackgroundByMusic() {
        const bgDiv = document.querySelector('.header-blur-bg');
        const imagePath = playlist[currentTrack]?.image || 'images/default.jpg';
        if (bgDiv) {
          bgDiv.style.backgroundImage = `url('${imagePath}')`;
          bgDiv.style.opacity = 1;
        }
      }
  
      playBtn.addEventListener('click', () => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
  
        if (audio.paused) {
          audio.src = playlist[currentTrack].src;
          audio.load();
          audio.play();
          draw();
          playBtn.textContent = '일시정지';
          updateHeaderBackgroundByMusic();
        } else {
          audio.pause();
          playBtn.textContent = '🎵 재생';
        }
      });
  
      audio.addEventListener('ended', () => {
        currentTrack = (currentTrack + 1) % playlist.length;
        audio.src = playlist[currentTrack].src;
        updateHeaderBackgroundByMusic();
        audio.play();
      });
  
      const content = document.getElementById('content');
      let currentCategory = '';
      let pages = {};
      let posts = {};
  
      // ✅ 로딩 중 표시
      content.innerHTML = `<p style="margin-top:50px;">⏳ 로딩중...</p>`;
  
      fetch('https://script.google.com/macros/s/AKfycbwHywDcQ4hjBjqNo3MeGO939rX_VwamcbZkAyxoaKktmntWk0UezPOK-tLH6UA9kC1Odw/exec')
        .then(res => res.json())
        .then(data => {
          const categorized = {};
          data.forEach((post, i) => {
            const {
              id,
              category,
              title,
              excerpt,
              content: fullContent,
            } = post;
  
            const postId = id || `${i}`;
            const categoryKey = (category || '').trim();
            const postTitle = title?.trim() || '(제목 없음)';
            const postExcerpt = excerpt?.trim() || '';
            const postContent = fullContent?.trim() || '(내용 없음)';
  
            if (!categorized[categoryKey]) categorized[categoryKey] = [];
            categorized[categoryKey].push({
              postId,
              title: postTitle,
              excerpt: postExcerpt,
              content: postContent,
            });
  
            posts[postId] = `
              <article>
                <h2>${postTitle}</h2>
                <p>${postContent}</p>
                <button id="backBtn">← 목록으로</button>
              </article>
            `;
          });
  
          // ✅ pages 생성
          for (const [categoryKey, list] of Object.entries(categorized)) {
            let emoji = '';
            if (categoryKey.includes('세상')) emoji = '🌿';
            else if (categoryKey.includes('개발')) emoji = '💻';
            else if (categoryKey.includes('점이')) emoji = '🐶';
            else if (categoryKey.includes('일상')) emoji = '☕';
  
            pages[categoryKey] = `
              <h2 style="margin-bottom: 20px;">${emoji} ${categoryKey}</h2>
              <div class="post-list">
                ${list.map(post => `
                  <div class="post-card" data-post="${post.postId}">
                    <div class="post-title">${post.title}</div>
                    <div class="post-excerpt">${post.excerpt}</div>
                  </div>
                `).join('')}
              </div>
            `;
          }
  
          // ✅ 카테고리 클릭 이벤트
          document.querySelectorAll('.category-card').forEach((card) => {
            card.addEventListener('click', (e) => {
              e.preventDefault();
              currentCategory = card.dataset.category.trim();
              content.innerHTML = pages[currentCategory] || `<p>글이 아직 없어요 :)</p>`;
              window.scrollTo({ top: content.offsetTop, behavior: 'smooth' });
            });
          });
        })
        .catch((err) => {
          console.error('❌ 데이터 불러오기 실패:', err);
          content.innerHTML = `<p style="margin-top:50px;">❌ 데이터 로딩 실패!</p>`;
        });
  
      // ✅ 글 보기 / 뒤로가기
      document.addEventListener('click', (e) => {
        const card = e.target.closest('.post-card');
        if (card?.dataset.post) {
          const postId = card.dataset.post;
          content.innerHTML = posts[postId] || `<p>글을 불러올 수 없습니다.</p>`;
          window.scrollTo({ top: content.offsetTop, behavior: 'smooth' });
        }
        if (e.target.id === 'backBtn') {
          content.innerHTML = pages[currentCategory] || '';
          window.scrollTo({ top: content.offsetTop, behavior: 'smooth' });
        }
      });
    });

    window.addEventListener('load', () => {
  setTimeout(() => {
    document.querySelector('.left-door').style.transform = 'translateX(-100%)';
    document.querySelector('.right-door').style.transform = 'translateX(100%)';
  }, 400); // 반박자 쉼
  setTimeout(() => {
    document.querySelectorAll('.door').forEach(el => el.remove());
  }, 1800); // 애니 끝나고 제거
});

  </script>
</body>
</html>
